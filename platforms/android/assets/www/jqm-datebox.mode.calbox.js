/*! CALBOX Mode */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeDateToday:"b",themeDayHigh:"b",themeDatePick:"b",themeDateHigh:"b",themeDateHighAlt:"b",themeDateHighRec:"b",themeDate:"a",calNextMonthIcon:"plus",calPrevMonthIcon:"minus",calHighToday:true,calHighPick:true,calShowDays:true,calOnlyMonth:false,calWeekMode:false,calWeekModeDay:1,calControlGroup:false,calShowWeek:false,calUsePickers:false,calNoHeader:false,calFormatter:false,calYearPickMin:-6,calYearPickMax:6,useTodayButton:false,useTomorrowButton:false,useCollapsedBut:false,highDays:false,highDates:false,highDatesRec:false,highDatesAlt:false,enableDates:false,calDateList:false,calShowDateList:false});a.extend(a.mobile.datebox.prototype,{_cal_gen:function(d,f,l,i,h){var b=0,e=0,k=1,g=1,c=[],m=[],j=false;for(b=0;b<=5;b++){if(j===false){m=[];for(e=0;e<=6;e++){if(b===0&&e<d){if(i===true){m.push([f+(e-d)+1,h-1])}else{m.push(false)}}else{if(b>3&&k>l){if(i===true){m.push([g,h+1]);g++}else{m.push(false)}j=true}else{m.push([k,h]);k++;if(k>l){j=true}}}}c.push(m)}}return c},_cal_check:function(s,m,l,e,h){var r=this,j,c=this.options,b=h.x,g=h.i,f=h.t,q=h.p,n=new this._date(m,l,e,0,0,0,0).getDay(),p=c.blackDatesRec,d=c.highDatesRec,k={ok:true,iso:m+"-"+r._zPad(l+1)+"-"+r._zPad(e),theme:c.themeDate,force:false,recok:true,rectheme:false};if(l===12){k.iso=(m+1)+"-01-"+r._zPad(e)}if(l===-1){k.iso=(m-1)+"-12-"+r._zPad(e)}k.comp=parseInt(k.iso.replace(/-/g,""),10);if(p!==false){for(j=0;j<p.length;j++){if((p[j][0]===-1||p[j][0]===m)&&(p[j][1]===-1||p[j][1]===l)&&(p[j][2]===-1||p[j][2]===e)){k.ok=false}}}if(a.isArray(c.enableDates)&&a.inArray(k.iso,c.enableDates)<0){k.ok=false}else{if(s){if((k.recok!==true)||(c.afterToday&&f.comp()>k.comp)||(c.beforeToday&&f.comp()<k.comp)||(c.notToday&&f.comp()===k.comp)||(c.maxDays!==false&&b.comp()<k.comp)||(c.minDays!==false&&g.comp()>k.comp)||(a.isArray(c.blackDays)&&a.inArray(n,c.blackDays)>-1)||(a.isArray(c.blackDates)&&a.inArray(k.iso,c.blackDates)>-1)){k.ok=false}}}if(a.isArray(c.whiteDates)&&a.inArray(k.iso,c.whiteDates)>-1){k.ok=true}if(k.ok){if(d!==false){for(j=0;j<d.length;j++){if((d[j][0]===-1||d[j][0]===m)&&(d[j][1]===-1||d[j][1]===l)&&(d[j][2]===-1||d[j][2]===e)){k.rectheme=true}}}if(c.calHighPick&&e===q&&(r.d.input.val()!==""||c.defaultValue!==false)){k.theme=c.themeDatePick}else{if(c.calHighToday&&k.comp===f.comp()){k.theme=c.themeDateToday}else{if(c.calHighPick&&r.calDateVisible&&r.calBackDate!==false&&r.calBackDate.comp()===k.comp){k.theme=c.themeDatePick;k.force=true}else{if(a.isArray(c.highDatesAlt)&&(a.inArray(k.iso,c.highDatesAlt)>-1)){k.theme=c.themeDateHighAlt}else{if(a.isArray(c.highDates)&&(a.inArray(k.iso,c.highDates)>-1)){k.theme=c.themeDateHigh}else{if(a.isArray(c.highDays)&&(a.inArray(n,c.highDays)>-1)){k.theme=c.themeDayHigh}else{if(a.isArray(c.highDatesRec)&&k.rectheme===true){k.theme=c.themeDateHighRec}}}}}}}}return k}});a.extend(a.mobile.datebox.prototype._build,{calbox:function(){var K,P,y,r,G,x,m,f,Q,n,C,O,S,b,I,g,J,N,H=this,L=this.options,R=L.calDateList,d="ui-datebox-",h=((H.calBackDate!==false&&H.theDate.get(0)===H.calBackDate.get(0)&&H.theDate.get(1)===H.calBackDate.get(1))?new H._date(H.calBackDate.getTime()):H.theDate),z=false,t={},c=H.initDate.copy(),l=H.initDate.copy(),B=(h.copy([0],[0,0,1]).getDay()-H.__("calStartDay")+7)%7,E=h.get(1),u=h.get(0),q=h.getArray(),e=(H.d.input.val()==="")?H._startOffset(H._makeDate(H.d.input.val())):H._makeDate(H.d.input.val()),v=-1,T=new H._date(),F=T.getArray(),p=h.copy([0],[0,0,1]).adj(2,(-1*B)+(H.__("calStartDay")===0?1:0)).getDWeek(4),j=0,D=false,s=false,k=32-H.theDate.copy([0],[0,0,32,13]).getDate(),A=32-H.theDate.copy([0,-1],[0,0,32,13]).getDate(),M=(L.afterToday||L.beforeToday||L.notToday||L.maxDays||L.minDays||L.blackDays||L.blackDates)?true:false;if(H.calBackDate!==false){if(H.theDate.get(0)===H.calBackDate.get(0)&&H.theDate.get(1)===H.calBackDate.get(1)){H.theDate=new H._date(H.calBackDate.getTime());H.calBackDate=false}}if(typeof H.d.intHTML!=="boolean"){H.d.intHTML.remove();H.d.intHTML=null}H.d.headerText=((H._grabLabel()!==false)?H._grabLabel():H.__("titleDateDialogLabel"));H.d.intHTML=a("<span>");a("<div class='"+d+"gridheader'><div class='"+d+"gridlabel'><h4>"+H._formatter(H.__("calHeaderFormat"),H.theDate)+"</h4></div></div>").appendTo(H.d.intHTML);a("<div class='"+d+"gridplus"+(H.__("isRTL")?"-rtl":"")+"'><a href='#'>"+H.__("nextMonth")+"</a></div>").prependTo(H.d.intHTML.find("."+d+"gridheader")).find("a").addClass("ui-btn-inline ui-link ui-btn ui-btn-"+L.themeDate+" ui-icon-"+L.calNextMonthIcon+" ui-btn-icon-notext ui-shadow ui-corner-all").on(L.clickEventAlt,function(i){i.preventDefault();if(H.calNext){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}if(H.theDate.getDate()>28){H.theDate.setDate(1)}H._offset("m",1)}});a("<div class='"+d+"gridminus"+(H.__("isRTL")?"-rtl":"")+"'><a href='#'>"+H.__("prevMonth")+"</a></div>").prependTo(H.d.intHTML.find("."+d+"gridheader")).find("a").addClass("ui-btn-inline ui-link ui-btn ui-btn-"+L.themeDate+" ui-icon-"+L.calPrevMonthIcon+" ui-btn-icon-notext ui-shadow ui-corner-all").on(L.clickEventAlt,function(i){i.preventDefault();if(H.calPrev){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}if(H.theDate.getDate()>28){H.theDate.setDate(1)}H._offset("m",-1)}});if(L.calNoHeader){if(L.calUsePickersIcons){H.d.intHTML.find("."+d+"gridlabel").hide()}else{H.d.intHTML.find("."+d+"gridheader").remove()}}H.calNext=true;H.calPrev=true;if(Math.floor(T.comp()/100)===Math.floor(h.comp()/100)){D=true}if(Math.floor(T.comp()/10000)===Math.floor(h.comp()/10000)){s=true}if(e.comp()===h.comp()){v=e.get(2)}if(L.afterToday&&(D||(s&&F[1]>=q[1]))){H.calPrev=false}if(L.beforeToday&&(D||(s&&F[1]<=q[1]))){H.calNext=false}if(L.minDays!==false){c.adj(2,L.minDays*-1);K=c.getArray();if(q[0]===K[0]&&q[1]<=K[1]){H.calPrev=false}}if(L.maxDays!==false){l.adj(2,L.maxDays);K=c.getArray();if(q[0]===K[0]&&q[1]>=K[1]){H.calNext=false}}if(L.calUsePickers){P=a("<div>");if(L.calNoHeader&&L.calUsePickersIcons){P.addClass("ui-datebox-pickicon")}P.i=a("<fieldset>").appendTo(P);P.a=a("<select>").appendTo(P.i);P.b=a("<select>").appendTo(P.i);for(O=0;O<=11;O++){P.a.append(a("<option value='"+O+"'"+((E===O)?" selected='selected'":"")+">"+H.__("monthsOfYear")[O]+"</option>"))}if(L.calYearPickMin<1){S=u+L.calYearPickMin}else{if(L.calYearPickMin<1800){S=u-L.calYearPickMin}else{if(L.calYearPickMin==="NOW"){S=F[0]}else{S=L.calYearPickMin}}}if(L.calYearPickMax<1800){b=u+L.calYearPickMax}else{if(L.calYearPickMax==="NOW"){b=F[0]}else{b=L.calYearPickMax}}for(O=S;O<=b;O++){P.b.append(a("<option value='"+O+"'"+((u===O)?" selected='selected'":"")+">"+O+"</option>"))}P.a.on("change",function(){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H.theDate.setD(1,a(this).val());if(H.theDate.get(1)!==parseInt(a(this).val(),10)){H.theDate.setD(2,0)}if(H.calBackDate!==false){H._t({method:"displayChange",selectedDate:H.calBackDate,shownDate:H.theDate,thisChange:"p",thisChangeAmount:null})}H.refresh()});P.b.on("change",function(){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H.theDate.setD(0,a(this).val());if(H.theDate.get(1)!==parseInt(P.a.val(),10)){H.theDate.setD(2,0)}if(H.calBackDate!==false){H._t({method:"displayChange",selectedDate:H.calBackDate,shownDate:H.theDate,thisChange:"p",thisChangeAmount:null})}H.refresh()});P.i.controlgroup({mini:true,type:"horizontal"});P.i.find("select").selectmenu({nativeMenu:true});P.i.find(".ui-controlgroup-controls").css({marginRight:"auto",marginLeft:"auto",width:"100%",display:"table",});P.i.find(".ui-select").first().css({width:"60%"}).end().last().css({width:"40%"});if(L.calNoHeader&&L.calUsePickersIcons){P.i.css({padding:"0 10px 5px 10px"})}P.appendTo(H.d.intHTML)}y=a("<div class='"+d+"grid'>").appendTo(H.d.intHTML);if(L.calShowDays){H._cal_days=H.__("daysOfWeekShort").concat(H.__("daysOfWeekShort"));G=a("<div>",{"class":d+"gridrow"}).appendTo(y);if(L.calControlGroup){G.addClass(d+"gridrow-last")}if(H.__("isRTL")===true){G.css("direction","rtl")}if(L.calShowWeek){a("<div>").addClass(d+"griddate "+d+"griddate-label").appendTo(G)}for(O=0;O<=6;O++){a("<div>").text(H._cal_days[(O+H.__("calStartDay"))%7]).addClass(d+"griddate "+d+"griddate-label").appendTo(G)}}t={i:c,x:l,t:T,p:v};r=H._cal_gen(B,A,k,!L.calOnlyMonth,h.get(1));if(!a.isFunction(L.calFormatter)&&L.calFormatter!==false&&a.isFunction(window[L.calFormatter])){L.calFormatter=window[L.calFormatter]}J=new Date(H.theDate.get(0),r[0][0][1],r[0][0][0],0,0,0,0);N=new Date(H.theDate.get(0),r[r.length-1][6][1],r[r.length-1][6][0],0,0,0,0);if(H.calBackDate===false){H.calDateVisible=true}else{if(L.calOnlyMonth){H.calDateVisible=false}else{if(H.calBackDate.comp()<J.comp()||H.calBackDate.comp()>N.comp()){H.calDateVisible=false}else{H.calDateVisible=true}}}for(m=0,Q=r.length;m<Q;m++){C=a("<div>",{"class":d+"gridrow"});if(H.__("isRTL")){C.css("direction","rtl")}if(L.calShowWeek){a("<div>",{"class":d+"griddate "+d+"griddate-empty"}).text("W"+p).css((L.calControlGroup?{"float":"left"}:{})).appendTo(C);p++;if(p>52&&typeof(r[m+1])!=="undefined"){p=new H._date(q[0],q[1],(H.__("calStartDay")===0)?r[m+1][1][0]:r[m+1][0][0],0,0,0,0).getDWeek(4)}}for(f=0,n=r[m].length;f<n;f++){if(L.calWeekMode){j=r[m][L.calWeekModeDay][0]}if(typeof r[m][f]==="boolean"){a("<div>",{"class":d+"griddate "+d+"griddate-empty"}).appendTo(C)}else{z=H._cal_check(M,q[0],r[m][f][1],r[m][f][0],t);if(r[m][f][0]){if(!a.isFunction(L.calFormatter)){I={text:r[m][f][0],"class":""}}else{g={Year:((r[m][f][1]>11)?u+1:(r[m][f][1]<0)?u-1:u),Month:((r[m][f][1]===12)?0:(r[m][f][1]===-1)?11:r[m][f][1]),Date:r[m][f][0]};g.ISO=g.Year+"-"+H._zPad(g.Month+1)+"-"+H._zPad(g.Date);g.Comp=parseInt(g.ISO.replace(/-/g,""),10);g.dateVisible=H.calDateVisible;K=L.calFormatter(g);if(typeof K!=="object"){I={text:K,"class":""}}else{I={text:K.text,"class":K["class"]}}}a("<div>").html(I.text).addClass(d+"griddate ui-corner-all ui-btn").addClass((E===r[m][f][1]||z.force)?("ui-btn-"+z.theme+(z.ok?"":" ui-state-disabled")):(d+"griddate-empty")).addClass(I["class"]).css((E!==r[m][f][1]&&!L.calOnlyMonth)?{cursor:"pointer"}:{}).data("date",((L.calWeekMode)?j:r[m][f][0])).data("enabled",z.ok).data("month",r[m][((L.calWeekMode)?L.calWeekModeDay:f)][1]).appendTo(C)}}}if(L.calControlGroup){C.controlgroup({type:"horizontal"})}if(m===Q-1){C.addClass(d+"gridrow-last")}C.appendTo(y)}if(L.calShowWeek){y.find("."+d+"griddate").addClass(d+"griddate-week")}if(L.calShowDateList&&R!==false){x=a("<div>");x.a=a("<select name='pickdate'></select>").appendTo(x);x.a.append("<option value='false' selected='selected'>"+H.__("calDateListLabel")+"</option>");for(O=0;O<R.length;O++){x.a.append(a("<option value='"+R[O][0]+"'>"+R[O][1]+"</option>"))}x.a.on("change",function(){K=a(this).val().split("-");H.theDate=new H._date(K[0],K[1]-1,K[2],0,0,0,0);H._t({method:"doset"})});x.find("select").selectmenu({mini:true,nativeMenu:true});x.appendTo(y)}if(L.useTodayButton||L.useTomorrowButton||L.useClearButton){C=a("<div>",{"class":d+"controls"});if(L.useTodayButton){a("<a href='#' role='button'>"+H.__("calTodayButtonLabel")+"</a>").appendTo(C).addClass("ui-btn ui-btn-"+L.theme+" ui-icon-navigation ui-btn-icon-left ui-shadow ui-corner-all").on(L.clickEvent,function(i){i.preventDefault();H.theDate=H._pa([0,0,0],new H._date());H.calBackDate=false;H._t({method:"doset"})})}if(L.useTomorrowButton){a("<a href='#' role='button'>"+H.__("calTomorrowButtonLabel")+"</a>").appendTo(C).addClass("ui-btn ui-btn-"+L.theme+" ui-icon-navigation ui-btn-icon-left ui-shadow ui-corner-all").on(L.clickEvent,function(i){i.preventDefault();H.theDate=H._pa([0,0,0],new H._date()).adj(2,1);H.calBackDate=false;H._t({method:"doset"})})}if(L.useClearButton){C.append(H._stdBtn.clear.apply(H))}if(L.useCollapsedBut){C.controlgroup({type:"horizontal"});C.addClass("ui-datebox-collapse")}else{C.controlgroup()}C.appendTo(y)}H.d.intHTML.on(L.clickEventAlt,"div."+d+"griddate",function(i){i.preventDefault();if(a(this).data("enabled")){H.calBackDate=false;H.theDate.setD(2,1).setD(1,a(this).jqmData("month")).setD(2,a(this).data("date"));H._t({method:"set",value:H._formatter(H.__fmt(),H.theDate),date:H.theDate});H._t({method:"close"})}});H.d.intHTML.on("swipeleft",function(){if(H.calNext){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H._offset("m",1)}}).on("swiperight",function(){if(H.calPrev){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H._offset("m",-1)}});if(H.wheelExists){H.d.intHTML.on("mousewheel",function(i,o){i.preventDefault();if(o>0&&H.calNext){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H.theDate.setD(2,1);H._offset("m",1)}if(o<0&&H.calPrev){if(H.calBackDate===false){H.calBackDate=new Date(H.theDate.getTime())}H.theDate.setD(2,1);H._offset("m",-1)}})}}})})(jQuery);