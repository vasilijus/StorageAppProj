(function(d){d.extend(d.mobile.datebox.prototype.options,{themeButton:"a",themeInput:"a",useSetButton:!0,validHours:!1,repButton:!0,durationStep:1,durationSteppers:{d:1,h:1,i:1,s:1}});d.extend(d.mobile.datebox.prototype,{_dbox_run:function(){var d=this,b=this.drag,c=150;10<b.cnt&&(c=100);30<b.cnt&&(c=50);60<b.cnt&&(c=20);120<b.cnt&&(c=10);240<b.cnt&&(c=3);b.didRun=!0;b.cnt++;d._offset(b.target[0],b.target[1],!1);d._dbox_run_update();d.runButton=setTimeout(function(){d._dbox_run()},c)},_dbox_fixstep:function(e){var b=
this.options.durationSteppers,c=this.options.durationStep;-1<d.inArray("s",e)&&(b.i=1,b.s=c);-1<d.inArray("i",e)&&(b.h=1,b.s=c);-1<d.inArray("h",e)&&(b.d=1,b.s=c)},_dbox_run_update:function(e){var b=this,c=this.options,f=b.theDate.getTime()-b.initDate.getTime(),a="durationbox"===c.mode?!0:!1,h=b._dur(0>f?0:f);0>f&&(b.lastDuration=0,a&&b.theDate.setTime(b.initDate.getTime()));if(a&&(!1!==c.minDur&&b.theDate.getEpoch()-b.initDate.getEpoch()<c.minDur&&(b.theDate=new Date(b.initDate.getTime()+1E3*c.minDur),
b.lastDuration=c.minDur,h=b._dur(1E3*c.minDur)),!1!==c.maxDur&&b.theDate.getEpoch()-b.initDate.getEpoch()>c.maxDur))b.theDate=new Date(b.initDate.getTime()+1E3*c.maxDur),b.lastDuration=c.maxDur,h=b._dur(1E3*c.maxDur);!0!==e&&!0!==a&&(b._check(),"datebox"===c.mode&&b.d.intHTML.find(".ui-datebox-header").find("h4").text(b._formatter(b.__("headerFormat"),b.theDate)),c.useSetButton&&(!1===b.dateOK?b.setBut.addClass("ui-state-disabled"):b.setBut.removeClass("ui-state-disabled")));b.d.divIn.find("input").each(function(){switch(d(this).data("field")){case "y":d(this).val(b.theDate.get(0));
break;case "m":d(this).val(b.theDate.get(1)+1);break;case "d":d(this).val(a?h[0]:b.theDate.get(2));break;case "h":a?d(this).val(h[1]):b.__("timeFormat")===12?d(this).val(b.theDate.get12hr()):d(this).val(b.theDate.get(3));break;case "i":a?d(this).val(h[2]):d(this).val(b._zPad(b.theDate.get(4)));break;case "M":d(this).val(b.__("monthsOfYearShort")[b.theDate.get(1)]);break;case "a":d(this).val(b.__("meridiem")[b.theDate.get(3)>11?1:0]);break;case "s":d(this).val(h[3])}});!0===b.__("useArabicIndic")&&
b._doIndic()},_dbox_vhour:function(e){var b=this.options,c,f=[25,0],a=[25,0];if(!1===b.validHours||-1<d.inArray(this.theDate.getHours(),b.validHours))return!0;c=this.theDate.getHours();d.each(b.validHours,function(){(c<this?1:-1)===e?f[0]>Math.abs(this-c)&&(f=[Math.abs(this-c),parseInt(this,10)]):a[0]>Math.abs(this-c)&&(a=[Math.abs(this-c),parseInt(this,10)])});0!==f[1]?this.theDate.setHours(f[1]):this.theDate.setHours(a[1])},_dbox_enter:function(e){var b,c=0;"M"===e.data("field")&&(b=d.inArray(e.val(),
this.__("monthsOfYearShort")),-1<b&&this.theDate.setMonth(b));if(""!==e.val()&&0===e.val().toString().search(/^[0-9]+$/))switch(e.data("field")){case "y":this.theDate.setD(0,parseInt(e.val(),10));break;case "m":this.theDate.setD(1,parseInt(e.val(),10)-1);break;case "d":this.theDate.setD(2,parseInt(e.val(),10));c+=86400*parseInt(e.val(),10);break;case "h":this.theDate.setD(3,parseInt(e.val(),10));c+=3600*parseInt(e.val(),10);break;case "i":this.theDate.setD(4,parseInt(e.val(),10));c+=60*parseInt(e.val(),
10);break;case "s":c+=parseInt(e.val(),10)}"durationbox"===this.options.mode&&this.theDate.setTime(this.initDate.getTime()+1E3*c);this.refresh()}});d.extend(d.mobile.datebox.prototype._build,{timebox:function(){this._build.datebox.apply(this,[])},durationbox:function(){this._build.datebox.apply(this,[])},datebox:function(){var e,b,c,f,a=this,h=this.drag,g=this.options,j="durationbox"===g.mode?!0:!1;c=-2;var p=["d","h","i","s"];e=d("<div>");var k=d("<fieldset>"),i=e.clone(),l=k.clone(),m=e.clone(),
q=d("<div><input type='text'></div>").addClass("ui-input-text ui-body-"+g.themeInput+" ui-corner-all ui-mini ui-shadow-inset"),n=d("<div></div>"),o="ui-btn-inline ui-link ui-btn ui-btn-"+g.themeButton+" ui-btn-icon-notext ui-shadow ui-corner-all";"boolean"!==typeof a.d.intHTML&&a.d.intHTML.empty().remove();a.d.headerText=!1!==a._grabLabel()?a._grabLabel():"datebox"===g.mode?a.__("titleDateDialogLabel"):a.__("titleTimeDialogLabel");a.d.intHTML=d("<span>");a.fldOrder="datebox"===g.mode?a.__("dateFieldOrder"):
j?a.__("durationOrder"):a.__("timeFieldOrder");j?(a.dateOK=!0,a._dbox_fixstep(a.fldOrder)):(a._check(),a._minStepFix(),a._dbox_vhour("undefined"!==typeof a._dbox_delta?a._dbox_delta:1));"datebox"===g.mode&&d("<div class='ui-datebox-header'><h4>"+a._formatter(a.__("headerFormat"),a.theDate)+"</h4></div>").appendTo(a.d.intHTML);for(b=0;b<a.fldOrder.length;b++)if(f=a._gridblk.b[b],e=j?g.durationSteppers[a.fldOrder[b]]:"i"===a.fldOrder[b]?g.minuteStep:1,"a"!==a.fldOrder[b]||12===a.__("timeFormat"))d("<div>").append(j?
"<label>"+a.__("durationLabel")[d.inArray(a.fldOrder[b],p)]+"</label>":"").addClass("ui-block-"+f).appendTo(m),d("<div>").append(a._makeEl(q,{attr:{field:a.fldOrder[b],amount:e}})).addClass("ui-block-"+f).appendTo(i).find("input").data({field:a.fldOrder[b],amount:e}),a._makeEl(n,{attr:{field:a.fldOrder[b],amount:e}}).addClass("ui-datebox-cbut ui-block-"+f+" ui-icon-plus "+o).appendTo(k).prepend(j?"<label>"+a.__("durationLabel")[b]+"</label>":""),a._makeEl(n,{attr:{field:a.fldOrder[b],amount:-1*e}}).addClass("ui-datebox-cbut ui-block-"+
f+" ui-icon-minus "+o).appendTo(l),c++;j&&m.addClass("ui-datebox-dboxlab ui-grid-"+a._gridblk.b[c]).appendTo(a.d.intHTML);k.addClass("ui-grid-"+a._gridblk.b[c]).appendTo(a.d.intHTML);i.addClass("ui-datebox-dboxin ui-grid-"+a._gridblk.b[c]).appendTo(a.d.intHTML);l.addClass("ui-grid-"+a._gridblk.b[c]).appendTo(a.d.intHTML);a.d.divIn=i;a._dbox_run_update(!0);!0!==a.dateOK?i.find("input").addClass("ui-state-disable"):i.find(".ui-state-disable").removeClass("ui-state-disable");if(g.useSetButton||g.useClearButton)c=
d("<div>",{"class":"ui-datebox-controls"}),g.useSetButton&&(a.setBut=a._stdBtn.close.apply(a,["datebox"===g.mode?a.__("setDateButtonLabel"):j?a.__("setDurationButtonLabel"):a.__("setTimeButtonLabel")]),a.setBut.appendTo(c)),g.useClearButton&&c.append(a._stdBtn.clear.apply(a)),g.useCollapsedBut?(c.controlgroup({type:"horizontal"}),c.addClass("ui-datebox-collapse")):c.controlgroup(),c.appendTo(a.d.intHTML);if(!g.repButton)a.d.intHTML.on(g.clickEvent,".ui-datebox-cbut",function(b){i.find(":focus").blur();
b.preventDefault();a._dbox_delta=d(this).data("amount")>1?1:-1;a._offset(d(this).data("field"),d(this).data("amount"))});i.on("change","input",function(){a._dbox_enter(d(this))});if(a.wheelExists)i.on("mousewheel","input",function(b,c){b.preventDefault();a._dbox_delta=c<0?-1:1;a._offset(d(this).data("field"),(c<0?-1:1)*d(this).data("amount"))});g.repButton&&(a.d.intHTML.on(h.eStart,".ui-datebox-cbut",function(){i.find(":focus").blur();f=[d(this).data("field"),d(this).data("amount")];h.move=true;h.cnt=
0;a._dbox_delta=d(this).data("amount")>1?1:-1;a._offset(f[0],f[1],false);a._dbox_run_update();if(!a.runButton){h.target=f;a.runButton=setTimeout(function(){a._dbox_run()},500)}}),a.d.intHTML.on(h.eEndA,".ui-datebox-cbut",function(b){if(h.move){b.preventDefault();clearTimeout(a.runButton);a.runButton=false;h.move=false}}))}})})(jQuery);